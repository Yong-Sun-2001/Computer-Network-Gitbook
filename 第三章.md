# 第三章——数据链路层

## 重点
1. 三个基本问题：封装成帧、透明传输、差错控制
2. 两种信道：点对点信道、广播信道
3. 协议
   1. PPP协议
      1. 透明传输：同步/异步传输
   2. CSMA/CD协议
4. 以太网
    1. 网络拓扑：星型拓扑
    2. 层次结构:LLC、MAC
    3. 扩展以太网：物理层扩展、数据链路层扩展
    4. VLAN：冲突域、广播域

## 内容

1. 两种信道
   - 点对点信道 PPP协议
   - 广播信道 CSMA/CD协议
   
2. 三个问题
   - 封装成帧：在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。重点是**帧定界**
     - 字节计数法
     - 字符填充法：需要不与透明传输冲突，则需要加入转义符
     - 比特填充法：每连续发送5个“1”后在 后面自动插入一个“0”
   
   - 透明传输
   
   - 差错检测：需要差错控制，分为**检错码**和**纠错码**
   
     - 检错码：奇偶校验码、CRC
   
       - 奇偶校验码：根据数据字节中1的个数来检验数据传输中是否 发生了错误。奇校验：使码字中“1”的总个数为奇数。
   
       - CRC：循环冗余码
   
         ![image-20211111212220625](images\image-20211111212220625.png)
   
         ![image-20211111212747105](images\image-20211111212747105.png)
   
         ![image-20211111212945903](images\image-20211111212945903.png)
   
     - 纠错码：海明码
   
       ![image-20211111213057625](images\image-20211111213057625.png)

3. 点对点信道，PPP协议：用户计算机和 ISP 进行通信时所使用的数据链路层协议就是 PPP 协议

   ![image-20211111214010653](images\image-20211111214010653.png)

4. 广播信道（局域网）：需要介质访问控制，解决媒体共享问题
   - 静态划分信道：频分/时分/码分/波分复用
   - 动态划分信道
      - ALOHA协议：想发就发
      - 时隙ALOHA协议：划分时间片
      - CSMA/CD协议：Carrier Sense Multiple Access with Collision Detection 载波监听 多点接入 / 碰撞检测 。
5. CSMA/CD协议：Carrier Sense Multiple Access with Collision Detection 载波监听、多点接入 / 碰撞检测 。
   - 多点接入”指总线型网络，表示许多计算机以多点接入的方式连接在一根总线上。“载波监听”是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞。
   - 每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要立即停止发送，免得继续浪费网络资源，然后等待一段随机时间后再次发送
   - 使用 CSMA/CD 协议的以太网不能进行全双工通信而只能进行双向交替通信（**半双工通信**）
   - **争用期**：以太网的端到端往返时延 2τ ,至多经过时间2τ（两倍的端到端往返时延）就可知道发送的数据帧是否遭受了碰撞
   - 二进制指数类型**退避算法**
   - ![image-20211111221139109](images\image-20211111221139109.png)
   - 10 Mbit/s 以太网取 51.2 μs 为争用期的长度。  对于 10 Mbit/s 以太网，在争用期内可发送 512 bit， 即 64 字节（最短有效帧长）
   - ![image-20211111221545507](images\image-20211111221545507.png)

6. 以太网：10Mbits/s，发展历程：粗同轴电缆-》细同轴电缆-》双绞线
   - 双绞线以太网：星形拓扑，中心为集线器、使用10BASE-T双绞线
   - 以太网信道利用率
      ![image-20211112091013251](images\image-20211112091013251.png)
      ![image-20211112090924249](images\image-20211112090924249.png)
      ![image-20211112091149957](images\image-20211112091149957.png)
   - 逻辑链路控制 LLC (Logical Link Control)子层：屏蔽对各种不同物理网络的访问方法的差异，向上提供数据传输服务的统一的逻辑接口
   - 媒体接入控制 MAC (Medium Access Control)子层：控制对传输介质的访问，并在物理层基础上实现无差错通信。该子层随不同的物理网络差异较大

7. MAC地址：6个字节【12位16进制数】
   - 常用的以太网 MAC 帧格式有两种标准 ： DIX Ethernet V2 标准、IIEEE 的 802.3 标准
   
   - 最常用的 MAC 帧是以太网 V2 的格式
     ![image-20211112091944313](images\image-20211112091944313.png)
     
   - 类型字段：用来标识上一层使用的是什么协议，以便把收到的MAC帧交给上一层的协议。
   
   - 前同步码：在帧的前面插入（硬件生成）的 8 字节中，第一个字段共 7个字节（7个重复的10101010），是前同步码，用来迅速实现 MAC 帧的比特同步。第二个字段 1 个字节（10101011）是帧开始定界符，表示后面的信息就是 MAC 帧。
   
   - 当数据字段的长度小于 46 字节时， 应在数据字段的后面加入整数字节的填充字段， 以保证以太网的 MAC 帧长不小于 64 字节。
8. 扩展以太网
   - 物理层扩展以太网：
   
     - 集线器，特点如下
       - 使用集线器的以太网在逻辑上仍是一个总线网，各工作站使用的还是 CSMA/CD 协议并共享逻辑上的总线
       - 集线器很像一个多接口的转发器，工作在物理层，不进行碰撞检测。
       - 优点：使原来属于不同碰撞域的以太网上的计算机能够进行跨碰撞域的通信
       - 缺点：碰撞域增大了，但总的吞吐量并未提高
       
     - 中继器：连接两个同轴电缆以太网，将信号放大整形后，以延伸网络的传输距离
   - 数据链路层扩展以太网：
     - 网桥：工作在数据链路层，根据 MAC 帧的目的地址对收到的帧进行转发和过滤
     
     - 以太网交换机：多端口网桥，具有自学习功能，采用生成树协议来减少消除兜圈子现象
     
       ![image-20211113125259709](images\image-20211113125259709.png)
   
9. VLAN
   - 虚拟局域网协议允许在以太网的帧格式中插入一个4字节的标识符，称为 VLAN 标记 (tag),插入 VLAN 标记得出的帧称为 802.1Q 帧 或 带标记的以太网帧
   - 广播域是广播帧能够到达的范围
   - 连接在同一个网桥或交换机端口的计算机构成一个冲突域
   - VLAN优点：
      - 有效控制广播域范围
      - 增强网络的安全性
      - 灵活构建虚拟工作组
      - 提高网络的可管理性
10. 以太网速率
   - 速率达到或超过 100 Mbit/s 的以太网称为高速以太网。
   - 100BASE-T 以太网又称为快速以太网，半双工，保持最短帧长不变，仍为64字节，一个网段的最大电缆长度为 100 m，争用期5.12 μs